<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="com.douzone.mapper.master">

    <select id="getShoppingCart" resultType="com.douzone.final_backend.DTO.ShoppingCartDTO">
        select g_code,
               g_count,
               g_name,
               g_status,
               g_price,
               g_discount,
               g_image,
               o_name
        from goods
                 left join owner o on goods.g_owner = o.o_sNumber
        where g_code = #{g_code};
    </select>

    <select id="getShopList" resultType="com.douzone.final_backend.DTO.ShopListDTO">
        <![CDATA[
        SELECT o_sNumber
             , o_phone
             , o_cellPhone
             , o_name
             , o_address
             , o_latitude
             , o_longitude
             , o_time1
             , o_time2
             , o_image
             , (6371 * acos(cos(radians(#{o_latitude})) * cos(radians(o_latitude)) * cos(radians(o_longitude)
            - radians(#{o_longitude})) + sin(radians(#{o_latitude})) * sin(radians(o_latitude))))
            AS distance
        FROM owner

        HAVING distance <= #{radius}

        ORDER BY distance

        LIMIT 0,300;
        ]]>

    </select>

</mapper>


